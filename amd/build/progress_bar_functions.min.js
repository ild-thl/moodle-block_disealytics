define("block_disealytics/progress_bar_functions",["exports","./add_interaction","core/ajax","core/modal_factory","./view_selection","./update_view","./progress_bar_modal"],(function(_exports,_add_interaction,_ajax,_modal_factory,_view_selection,_update_view,_progress_bar_modal){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_progress_bar_modal=_interopRequireDefault(_progress_bar_modal);_exports.init=()=>{const openProgressBarModalBtn=document.getElementById("block_disealytics_open-progress-bar-modal");openProgressBarModalBtn&&openProgressBarModalBtn.addEventListener("click",(async()=>{(await _modal_factory.default.create({type:_progress_bar_modal.default.TYPE,removeOnClose:!0})).show(),function(){const accordion=document.getElementById("progress-bar-accordion");accordion.querySelectorAll(".accordion-head").forEach(((head,index)=>{head.addEventListener("click",(()=>{(0,_add_interaction.toggleAccordion)(accordion,index+1)}))}))}(),function(){const addContainer=document.querySelector(".add-optional-input-container"),addFieldBtn=document.getElementById("add-optional-input-fields"),addBtn=document.getElementById("add-optional-input-button"),cancelBtn=document.getElementById("cancel-optional-input-button");addFieldBtn&&addFieldBtn.addEventListener("click",(()=>{addFieldBtn.classList.add("hidden"),addContainer.classList.remove("hidden")}));addBtn&&addBtn.addEventListener("click",(async function(){const material=document.getElementById("optional-input-document"),currentpage=document.getElementById("optional-input-currentpage"),lastpage=document.getElementById("optional-input-lastpage"),time=document.getElementById("optional-input-expenditureoftime");switch(validateInputs(currentpage.value,lastpage.value,time.value,material)){case"correct":await function(material,currentpage,lastpage,time){_ajax.default.call([{methodname:"block_disealytics_optional_input",args:{calltype:"add",id:-1,courseid:(0,_view_selection.getCourseId)(),name:material.value,currentpage:currentpage.value,lastpage:lastpage.value,expenditureoftime:time.value}}])[0].done((async function(){resetInputFields(),await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"])})).fail((err=>{window.console.log(err)}))}(material,currentpage,lastpage,time),resetInputFields(),addFieldBtn.classList.remove("hidden"),addContainer.classList.add("hidden"),await showMessage(document.getElementById("optional-inputs-save-successful"));break;case"document":await showMessage(document.querySelector(".nodocumentselectederror"));break;case"pagenumber":await showMessage(document.querySelector(".pageerror"));break;case"pagezero":await showMessage(document.querySelector(".lastpagezeroerror"));break;case"negative":await showMessage(document.querySelector(".negativepageerror"));break;case"beyondlimit":await showMessage(document.querySelector(".pageoverflowerror"));break;case"timebeyond":await showMessage(document.querySelector(".expenditureoftimeoverflowerror"));break;case"notanumber":await showMessage(document.querySelector(".notanumbererror"))}}));cancelBtn&&cancelBtn.addEventListener("click",(()=>{addFieldBtn.classList.remove("hidden"),addContainer.classList.add("hidden"),resetInputFields()}));const deleteButtons=document.querySelectorAll(".delete-optional-input-button");deleteButtons&&deleteButtons.forEach(((deleteBtn,index)=>{deleteBtn.addEventListener("click",(async function(){const id=document.querySelectorAll(".optional-input-container")[index].getAttribute("data-optionalinputid");await function(id){_ajax.default.call([{methodname:"block_disealytics_optional_input",args:{calltype:"delete",id:String(id)}}])[0].done((async function(){await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"])})).fail((err=>{window.console.log(err)}))}(id),await showMessage(document.querySelector("#optional-inputs-deletion-successful"))}))}));const updateButtons=document.querySelectorAll(".update-optional-input-button"),editButtons=document.querySelectorAll(".edit-optional-input-button"),cancelUpdateButtons=document.querySelectorAll(".cancel-update-optional-input-button");editButtons&&editButtons.forEach(((editBtn,index)=>{editBtn.addEventListener("click",(()=>{const editContainer=document.querySelectorAll(".optional-input-container")[index];editContainer.classList.add("hidden"),editContainer.nextElementSibling.classList.remove("hidden")}))}));cancelUpdateButtons&&cancelUpdateButtons.forEach(((cancelUpdateBtn,index)=>{cancelUpdateBtn.addEventListener("click",(()=>{const editContainer=document.querySelectorAll(".optional-input-container")[index];editContainer.classList.remove("hidden"),editContainer.nextElementSibling.classList.add("hidden")}))}));updateButtons&&updateButtons.forEach(((updateBtn,index)=>{updateBtn.addEventListener("click",(async function(){const editForm=document.querySelectorAll(".edit-optional-input-container")[index],currentpage=editForm.querySelector(".optional-input-update-currentpage"),lastpage=editForm.querySelector(".optional-input-update-lastpage"),time=editForm.querySelector(".optional-input-update-expenditureoftime"),material=editForm.querySelector(".optional-input-document-name"),id=editForm.getAttribute("data-optionalinputid");switch(validateInputs(currentpage.value,lastpage.value,time.value)){case"correct":await function(id,material,currentpage,lastpage,time){_ajax.default.call([{methodname:"block_disealytics_optional_input",args:{calltype:"update",id:String(id),courseid:(0,_view_selection.getCourseId)(),name:material.textContent,currentpage:currentpage.value,lastpage:lastpage.value,expenditureoftime:time.value}}])[0].done((async function(){await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"])})).fail((err=>{window.console.log(err)}))}(id,material,currentpage,lastpage,time),editForm.classList.add("hidden"),editForm.previousElementSibling.classList.remove("hidden"),await showMessage(editForm.querySelector(".optional-inputs-update-successful"));break;case"document":await showMessage(document.querySelector(".optional-input-update-warning.nodocumentselectederror"));break;case"pagenumber":await showMessage(document.querySelector(".optional-input-update-warning.pageerror"));break;case"pagezero":await showMessage(document.querySelector(".optional-input-update-warning.lastpagezeroerror"));break;case"negative":await showMessage(document.querySelector(".optional-input-update-warning.negativepageerror"));break;case"beyondlimit":await showMessage(document.querySelector(".optional-input-update-warning.pageoverflowerror"));break;case"timebeyond":await showMessage(document.querySelector(".optional-input-update-warning.expenditureoftimeoverflowerror"));break;case"notanumber":await showMessage(document.querySelector(".optional-input-update-warning.notanumbererror"))}}))}))}()}))};const showMessage=async messageElement=>{messageElement.classList.remove("hidden"),await new Promise((resolve=>setTimeout(resolve,2e3))),messageElement.classList.add("hidden")};function resetInputFields(){document.getElementById("optional-input-document").selectedIndex=0,document.getElementById("optional-input-currentpage").value=1,document.getElementById("optional-input-lastpage").value=1,document.getElementById("optional-input-expenditureoftime").value=1}function validateInputs(currentpage,lastpage,time){let material=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null!==material){if("0"===material.selectedOptions[0].getAttribute("data-documentselected"))return"document"}return currentpage>lastpage?"pagenumber":0===lastpage?"pagezero":lastpage<0||currentpage<0||time<0?"negative":lastpage>1e3||currentpage>1e3?"beyondlimit":time>500?"timebeyond":isNaN(currentpage)||isNaN(lastpage)||isNaN(time)?"notanumber":"correct"}}));

//# sourceMappingURL=progress_bar_functions.min.js.map