define("block_disealytics/progress_bar_functions",["exports","./add_interaction","core/ajax","core/modal_factory","core/templates","./view_selection","./update_view","core/str","core/modal_events"],(function(_exports,_add_interaction,_ajax,_modal_factory,_templates,_view_selection,_update_view,_str,_modal_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_templates=_interopRequireDefault(_templates),_modal_events=_interopRequireDefault(_modal_events);let progressBarModals=[];_exports.init=()=>{!function(){const progressBarModalBtns=document.querySelectorAll(".block_disealytics_open-progress-bar-modal");progressBarModalBtns&&progressBarModalBtns.forEach((progressBarModalBtn=>{progressBarModalBtn.addEventListener("click",(async function(){const learningMaterials=await new Promise(((resolve,reject)=>{_ajax.default.call([{methodname:"block_disealytics_get_learning_materials",args:{courseid:(0,_view_selection.getCourseId)()}}])[0].done((function(data){resolve(data)})).fail((function(err){reject(err)}))})),progressBarModal=await _modal_factory.default.create({title:await(0,_str.get_string)("progress_config_title","block_disealytics"),body:await _templates.default.render("block_disealytics/progress_bar_modal",learningMaterials),removeOnClose:!0});progressBarModals.push(progressBarModal),await progressBarModal.show(),function(){const accordion=document.getElementById("progress-bar-accordion");accordion.querySelectorAll(".accordion-head").forEach(((head,index)=>{head.addEventListener("click",(()=>{(0,_add_interaction.toggleAccordion)(accordion,index+1)}))}))}(),function(learningMaterials){const helpBtn=document.getElementById("block_disealytics_open-progress-bar-help-modal");helpBtn&&helpBtn.addEventListener("click",(async()=>{const helpModal=await _modal_factory.default.create({type:_modal_factory.default.types.OK,title:await(0,_str.get_string)("progress_config_help_title","block_disealytics"),body:await(0,_str.get_string)("learning_materials-view_help_info_text","block_disealytics"),removeOnClose:!0});progressBarModals.push(helpModal),await helpModal.show()}));const addFieldBtn=document.getElementById("add-learning-material-fields");addFieldBtn&&addFieldBtn.addEventListener("click",(async()=>{const addLearningMaterialModal=await _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:await(0,_str.get_string)("progress_config_help_title","block_disealytics"),body:await _templates.default.render("block_disealytics/learning_material_add_inputs",learningMaterials),removeOnClose:!0});addLearningMaterialModal.setSaveButtonText(await(0,_str.get_string)("learning_material_save","block_disealytics")),progressBarModals.push(addLearningMaterialModal),addLearningMaterialModal.show(),addLearningMaterialModal.getRoot().on(_modal_events.default.save,(async function(){const material=document.getElementById("learning-material-document"),currentpage=document.getElementById("learning-material-currentpage"),lastpage=document.getElementById("learning-material-lastpage"),time=document.getElementById("learning-material-expenditureoftime");switch(validateInputs(currentpage.value,lastpage.value,time.value,material)){case"correct":await function(material,currentpage,lastpage,time){_ajax.default.call([{methodname:"block_disealytics_learning_material",args:{calltype:"add",id:-1,courseid:(0,_view_selection.getCourseId)(),name:material.value,currentpage:currentpage.value,lastpage:lastpage.value,expenditureoftime:time.value}}])[0].done((async function(){await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"]),await closeModals()})).fail((err=>{window.console.log(err)}))}(material,currentpage,lastpage,time);break;case"document":await showMessage(document.querySelector(".nodocumentselectederror"));break;case"pagenumber":await showMessage(document.querySelector(".pageerror"));break;case"pagezero":await showMessage(document.querySelector(".lastpagezeroerror"));break;case"negative":await showMessage(document.querySelector(".negativepageerror"));break;case"beyondlimit":await showMessage(document.querySelector(".pageoverflowerror"));break;case"timebeyond":await showMessage(document.querySelector(".expenditureoftimeoverflowerror"));break;case"notanumber":await showMessage(document.querySelector(".notanumbererror"))}}))}));const deleteButtons=document.querySelectorAll(".delete-learning-material-button");deleteButtons&&deleteButtons.forEach(((deleteBtn,index)=>{deleteBtn.addEventListener("click",(async function(){const id=document.querySelectorAll(".learning-material-container")[index].getAttribute("data-learningmaterialid");await function(id){_ajax.default.call([{methodname:"block_disealytics_learning_material",args:{calltype:"delete",id:id}}])[0].done((async function(){await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"]),await closeModals()})).fail((err=>{window.console.log(err)}))}(id)}))}));const updateButtons=document.querySelectorAll(".update-learning-material-button"),editButtons=document.querySelectorAll(".edit-learning-material-button"),cancelUpdateButtons=document.querySelectorAll(".cancel-update-learning-material-button");editButtons&&editButtons.forEach(((editBtn,index)=>{editBtn.addEventListener("click",(()=>{const editContainer=document.querySelectorAll(".learning-material-container")[index];editContainer.classList.add("hidden"),editContainer.nextElementSibling.classList.remove("hidden");!function(documentId){initialValues={currentPage:document.getElementById("learning-material-update-currentpage-"+documentId).value,lastPage:document.getElementById("learning-material-update-lastpage-"+documentId).value,expenditureOfTime:document.getElementById("learning-material-update-expenditureoftime-"+documentId).value}}(editContainer.getAttribute("data-learningmaterialid"))}))}));cancelUpdateButtons&&cancelUpdateButtons.forEach(((cancelUpdateBtn,index)=>{cancelUpdateBtn.addEventListener("click",(()=>{const editContainer=document.querySelectorAll(".learning-material-container")[index];editContainer.classList.remove("hidden"),editContainer.nextElementSibling.classList.add("hidden");!function(documentId){document.getElementById("learning-material-update-currentpage-"+documentId).value=initialValues.currentPage,document.getElementById("learning-material-update-lastpage-"+documentId).value=initialValues.lastPage,document.getElementById("learning-material-update-expenditureoftime-"+documentId).value=initialValues.expenditureOfTime}(editContainer.getAttribute("data-learningmaterialid"))}))}));updateButtons&&updateButtons.forEach(((updateBtn,index)=>{updateBtn.addEventListener("click",(async function(){const editForm=document.querySelectorAll(".edit-learning-material-container")[index],currentpage=editForm.querySelector(".learning-material-update-currentpage"),lastpage=editForm.querySelector(".learning-material-update-lastpage"),time=editForm.querySelector(".learning-material-update-expenditureoftime"),material=editForm.querySelector(".learning-material-document-name"),id=editForm.getAttribute("data-learningmaterialid");switch(validateInputs(currentpage.value,lastpage.value,time.value)){case"correct":await function(id,material,currentpage,lastpage,time){_ajax.default.call([{methodname:"block_disealytics_learning_material",args:{calltype:"update",id:String(id),courseid:(0,_view_selection.getCourseId)(),name:material.textContent,currentpage:currentpage.value,lastpage:lastpage.value,expenditureoftime:time.value}}])[0].done((async function(){await(0,_update_view.updateView)((0,_view_selection.getCourseId)(),["progress-bar-view"]),await closeModals()})).fail((err=>{window.console.log(err)}))}(id,material,currentpage,lastpage,time),editForm.classList.add("hidden"),editForm.previousElementSibling.classList.remove("hidden");break;case"document":await showMessage(document.querySelector(".learning-material-update-warning.nodocumentselectederror"));break;case"pagenumber":await showMessage(document.querySelector(".learning-material-update-warning.pageerror"));break;case"pagezero":await showMessage(document.querySelector(".learning-material-update-warning.lastpagezeroerror"));break;case"negative":await showMessage(document.querySelector(".learning-material-update-warning.negativepageerror"));break;case"beyondlimit":await showMessage(document.querySelector(".learning-material-update-warning.pageoverflowerror"));break;case"timebeyond":await showMessage(document.querySelector(".learning-material-update-warning.expenditureoftimeoverflowerror"));break;case"notanumber":await showMessage(document.querySelector(".learning-material-update-warning.notanumbererror"))}}))}))}(learningMaterials)}))}))}()};const showMessage=async messageElement=>{messageElement.classList.remove("hidden"),await new Promise((resolve=>setTimeout(resolve,2e3))),messageElement.classList.add("hidden")};let initialValues={};const closeModals=()=>{progressBarModals.forEach((modal=>{modal&&modal.destroy()}))};function validateInputs(currentpage,lastpage,time){let material=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null!==material){if("0"===material.selectedOptions[0].getAttribute("data-documentselected"))return"document"}return currentpage>lastpage?"pagenumber":0===lastpage?"pagezero":lastpage<0||currentpage<0||time<0?"negative":lastpage>1e3||currentpage>1e3?"beyondlimit":time>500?"timebeyond":isNaN(currentpage)||isNaN(lastpage)||isNaN(time)?"notanumber":"correct"}}));

//# sourceMappingURL=progress_bar_functions.min.js.map