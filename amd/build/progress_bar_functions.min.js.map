{"version":3,"file":"progress_bar_functions.min.js","sources":["../src/progress_bar_functions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {toggleAccordion} from \"./add_interaction\";\nimport Ajax from 'core/ajax';\nimport {getCourseId} from \"./view_selection\";\nimport {updateView} from \"./update_view\";\n\n/**\n * Initialize the progress bar interface.\n */\nexport const init = () => {\n    // Attach click event to each accordion head.\n    const accordion = document.getElementById('progress-bar-accordion');\n    const accordionHeads = accordion.querySelectorAll('.accordion-head');\n    accordionHeads.forEach((head, index) => {\n        head.addEventListener('click', () => {\n            toggleAccordion(accordion, index + 1);\n        });\n    });\n    initButtonsInOptionalInputModal();\n};\n\n/**\n * Initializes event listeners for buttons in the optional input modal.\n * Manages the logic for adding, updating, deleting, and cancelling optional inputs.\n */\nfunction initButtonsInOptionalInputModal() {\n    // Add input.\n    const addContainer = document.querySelector('.add-optional-input-container');\n    const addFieldBtn = document.getElementById('add-optional-input-fields');\n    const addBtn = document.getElementById('add-optional-input-button');\n    const cancelBtn = document.getElementById('cancel-optional-input-button');\n\n    if (addFieldBtn) {\n        addFieldBtn.addEventListener('click', () => {\n            addFieldBtn.classList.add('hidden');\n            addContainer.classList.remove('hidden');\n        });\n    }\n\n    if (addBtn) {\n        addBtn.addEventListener('click', async function() {\n            const material = document.getElementById('optional-input-document');\n            const currentpage = document.getElementById('optional-input-currentpage');\n            const lastpage = document.getElementById('optional-input-lastpage');\n            const time = document.getElementById('optional-input-expenditureoftime');\n            switch (validateInputs(currentpage.value, lastpage.value, time.value, material)) {\n                case 'correct':\n                    await addOptionalInput(material, currentpage, lastpage, time);\n                    resetInputFields();\n                    addFieldBtn.classList.remove('hidden');\n                    addContainer.classList.add('hidden');\n                    await showMessage(document.getElementById('optional-inputs-save-successful'));\n                    break;\n                case 'document':\n                    await showMessage(document.querySelector('.nodocumentselectederror'));\n                    break;\n                case 'pagenumber':\n                    await showMessage(document.querySelector('.pageerror'));\n                    break;\n                case 'pagezero':\n                    await showMessage(document.querySelector('.lastpagezeroerror'));\n                    break;\n                case 'negative':\n                    await showMessage(document.querySelector('.negativepageerror'));\n                    break;\n                case 'beyondlimit':\n                    await showMessage(document.querySelector('.pageoverflowerror'));\n                    break;\n                case 'timebeyond':\n                    await showMessage(document.querySelector('.expenditureoftimeoverflowerror'));\n                    break;\n                case 'notanumber':\n                    await showMessage(document.querySelector('.notanumbererror'));\n                    break;\n            }\n        });\n    }\n\n    if (cancelBtn) {\n        cancelBtn.addEventListener('click', () => {\n            addFieldBtn.classList.remove('hidden');\n            addContainer.classList.add('hidden');\n            resetInputFields();\n        });\n    }\n\n    // Delete input.\n    const deleteButtons = document.querySelectorAll('.delete-optional-input-button');\n\n    if (deleteButtons) {\n        deleteButtons.forEach((deleteBtn, index) => {\n            deleteBtn.addEventListener('click', async function() {\n                    const editContainer = document.querySelectorAll('.optional-input-container')[index];\n                    const id = editContainer.getAttribute('data-optionalinputid');\n                    await deleteOptionalInput(id);\n                    await showMessage(document.querySelector('#optional-inputs-deletion-successful'));\n                }\n            );\n        });\n    }\n\n    // Edit input.\n    const updateButtons = document.querySelectorAll('.update-optional-input-button');\n    const editButtons = document.querySelectorAll('.edit-optional-input-button');\n    const cancelUpdateButtons = document.querySelectorAll('.cancel-update-optional-input-button');\n\n    if (editButtons) {\n        editButtons.forEach((editBtn, index) => {\n            editBtn.addEventListener('click', () => {\n                const editContainer = document.querySelectorAll('.optional-input-container')[index];\n                editContainer.classList.add('hidden');\n                editContainer.nextElementSibling.classList.remove('hidden');\n            });\n        });\n    }\n\n    if (cancelUpdateButtons) {\n        cancelUpdateButtons.forEach((cancelUpdateBtn, index) => {\n            cancelUpdateBtn.addEventListener('click', () => {\n                const editContainer = document.querySelectorAll('.optional-input-container')[index];\n                editContainer.classList.remove('hidden');\n                editContainer.nextElementSibling.classList.add('hidden');\n            });\n        });\n    }\n\n    if (updateButtons) {\n        updateButtons.forEach((updateBtn, index) => {\n            updateBtn.addEventListener('click', async function() {\n                    const editForm = document.querySelectorAll('.edit-optional-input-container')[index];\n                    const currentpage = editForm.querySelector('.optional-input-update-currentpage');\n                    const lastpage = editForm.querySelector('.optional-input-update-lastpage');\n                    const time = editForm.querySelector('.optional-input-update-expenditureoftime');\n                    const material = editForm.querySelector('.optional-input-document-name');\n                    const id = editForm.getAttribute('data-optionalinputid');\n                    switch (validateInputs(currentpage.value, lastpage.value, time.value)) {\n                        case 'correct':\n                            await updateOptionalInput(id, material, currentpage, lastpage, time);\n                            editForm.classList.add('hidden');\n                            editForm.previousElementSibling.classList.remove('hidden');\n                            await showMessage(editForm.querySelector('.optional-inputs-update-successful'));\n                            break;\n                        case 'document':\n                            await showMessage(document.querySelector('.optional-input-update-warning.nodocumentselectederror'));\n                            break;\n                        case 'pagenumber':\n                            await showMessage(document.querySelector('.optional-input-update-warning.pageerror'));\n                            break;\n                        case 'pagezero':\n                            await showMessage(document.querySelector('.optional-input-update-warning.lastpagezeroerror'));\n                            break;\n                        case 'negative':\n                            await showMessage(document.querySelector('.optional-input-update-warning.negativepageerror'));\n                            break;\n                        case 'beyondlimit':\n                            await showMessage(document.querySelector('.optional-input-update-warning.pageoverflowerror'));\n                            break;\n                        case 'timebeyond':\n                            // eslint-disable-next-line max-len\n                            await showMessage(document.querySelector('.optional-input-update-warning.expenditureoftimeoverflowerror'));\n                            break;\n                        case 'notanumber':\n                            await showMessage(document.querySelector('.optional-input-update-warning.notanumbererror'));\n                            break;\n                    }\n                }\n            );\n        });\n    }\n}\n\n/**\n * Displays a message element for a short duration and then hides it.\n *\n * @param {HTMLElement} messageElement - The HTML element representing the message.\n * @returns {Promise<void>} A Promise that resolves after the message is hidden.\n */\nconst showMessage = async(messageElement) => {\n    messageElement.classList.remove('hidden');\n\n    await new Promise(resolve => setTimeout(resolve, 2000));\n\n    messageElement.classList.add('hidden');\n};\n\n/**\n * Resets the values of input fields to their default or initial state.\n *\n * @returns {void}\n */\nfunction resetInputFields() {\n    document.getElementById('optional-input-document').selectedIndex = 0;\n    document.getElementById('optional-input-currentpage').value = 1;\n    document.getElementById('optional-input-lastpage').value = 1;\n    document.getElementById('optional-input-expenditureoftime').value = 1;\n}\n\n/**\n * Validates input fields for optional inputs.\n *\n * @param {number} currentpage - The value of the current page.\n * @param {number} lastpage - The value of the last page.\n * @param {number} time - The value of the time spent.\n * @param {HTMLElement} [material=null] - The optional input material element.\n * @returns {string} A string indicating the validation result:\n *  - 'document': No document selected.\n *  - 'pagenumber': Current page exceeds last page.\n *  - 'pagezero': Last page is zero.\n *  - 'negative': Negative values entered.\n *  - 'beyondlimit': Page number exceeds limit.\n *  - 'timebeyond': Time exceeds limit.\n *  - 'notanumber': Non-numeric values entered.\n *  - 'correct': Inputs are valid.\n */\nfunction validateInputs(currentpage, lastpage, time, material = null) {\n    if (!(material === null)) {\n        const selectedOption = material.selectedOptions[0];\n        const dataDocumentSelected = selectedOption.getAttribute(\"data-documentselected\");\n        if (dataDocumentSelected === \"0\") {\n            return \"document\";\n        }\n    }\n    if (currentpage > lastpage) {\n        return \"pagenumber\";\n    }\n    if (lastpage === 0) {\n        return \"pagezero\";\n    }\n    if (lastpage < 0 || currentpage < 0 || time < 0) {\n        return \"negative\";\n    }\n    if (lastpage > 1000 || currentpage > 1000) {\n        return \"beyondlimit\";\n    }\n    if (time > 500) {\n        return \"timebeyond\";\n    }\n    if (isNaN(currentpage) || isNaN(lastpage) || isNaN(time)) {\n        return \"notanumber\";\n    }\n    return \"correct\";\n}\n\n/**\n * Adds an optional input to the system.\n *\n * @param {HTMLSelectElement} material - The material select element.\n * @param {HTMLInputElement} currentpage - The input element for current page.\n * @param {HTMLInputElement} lastpage - The input element for last page.\n * @param {HTMLInputElement} time - The input element for time expenditure.\n */\nfunction addOptionalInput(material, currentpage, lastpage, time) {\n    Ajax.call([{\n        methodname: 'block_disealytics_optional_input',\n        args: {\n            calltype: 'add',\n            id: -1,\n            courseid: getCourseId(),\n            name: material.value,\n            currentpage: currentpage.value,\n            lastpage: lastpage.value,\n            expenditureoftime: time.value,\n        }\n    }])[0].done(async function() {\n        resetInputFields();\n        await updateView(getCourseId(), ['progress-bar-view']);\n    }).fail(err => {\n        window.console.log(err);\n    });\n}\n\n/**\n * Updates an existing optional input in the system.\n *\n * @param {string} id - The unique identifier of the optional input.\n * @param {HTMLElement} material - The material element containing the updated content.\n * @param {HTMLInputElement} currentpage - The input element for current page.\n * @param {HTMLInputElement} lastpage - The input element for last page.\n * @param {HTMLInputElement} time - The input element for time expenditure.\n */\nfunction updateOptionalInput(id, material, currentpage, lastpage, time) {\n    Ajax.call([{\n        methodname: 'block_disealytics_optional_input',\n        args: {\n            calltype: 'update',\n            id: String(id),\n            courseid: getCourseId(),\n            name: material.textContent,\n            currentpage: currentpage.value,\n            lastpage: lastpage.value,\n            expenditureoftime: time.value,\n        }\n    }])[0].done(async function() {\n        await updateView(getCourseId(), ['progress-bar-view']);\n    }).fail(err => {\n        window.console.log(err);\n    });\n}\n\n/**\n * Deletes an existing optional input from the system.\n *\n * @param {string} id - The unique identifier of the optional input to be deleted.\n */\nfunction deleteOptionalInput(id) {\n    Ajax.call([{\n        methodname: 'block_disealytics_optional_input',\n        args: {\n            calltype: 'delete',\n            id: String(id),\n        }\n    }])[0].done(async function() {\n        await updateView(getCourseId(), ['progress-bar-view']);\n    }).fail(err => {\n        window.console.log(err);\n    });\n}\n"],"names":["accordion","document","getElementById","querySelectorAll","forEach","head","index","addEventListener","addContainer","querySelector","addFieldBtn","addBtn","cancelBtn","classList","add","remove","async","material","currentpage","lastpage","time","validateInputs","value","call","methodname","args","calltype","id","courseid","name","expenditureoftime","done","resetInputFields","fail","err","window","console","log","addOptionalInput","showMessage","deleteButtons","deleteBtn","getAttribute","String","deleteOptionalInput","updateButtons","editButtons","cancelUpdateButtons","editBtn","editContainer","nextElementSibling","cancelUpdateBtn","updateBtn","editForm","textContent","updateOptionalInput","previousElementSibling","initButtonsInOptionalInputModal","messageElement","Promise","resolve","setTimeout","selectedIndex","selectedOptions","isNaN"],"mappings":"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"}